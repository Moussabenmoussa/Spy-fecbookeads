<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pSEO Dashboard - Hybrid Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>body { background: #111827; color: white; font-family: sans-serif; }</style>
</head>
<body class="p-6">
    {% raw %}
    <div id="app" class="max-w-5xl mx-auto">
        
        <header class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4">
            <h1 class="text-2xl font-bold text-blue-500"><i class="fas fa-rocket"></i> pSEO Commander</h1>
            <div class="flex gap-2">
                <input v-model="password" type="password" placeholder="Secret Key" class="bg-gray-800 p-2 rounded border border-gray-600 text-sm">
            </div>
        </header>

        <!-- HYBRID WRITER SECTION -->
        <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden shadow-2xl">
            <div class="bg-gray-900 p-4 border-b border-gray-700 flex justify-between items-center">
                <h2 class="font-bold text-lg text-white"><i class="fas fa-pen-nib text-purple-500"></i> الكاتب الهجين (Gemini Assistant)</h2>
                <span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">Manual Quality Mode</span>
            </div>
            
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- STEP 1: Define Target -->
                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-blue-400 uppercase">1. حدد الهدف</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <input v-model="target.device" placeholder="Device (e.g. Samsung TV)" class="bg-gray-900 p-3 rounded border border-gray-600 w-full text-sm">
                        <input v-model="target.country" placeholder="Country (e.g. UK)" class="bg-gray-900 p-3 rounded border border-gray-600 w-full text-sm">
                    </div>
                    <input v-model="target.app_name" placeholder="Best App (e.g. IBO Player)" class="bg-gray-900 p-3 rounded border border-gray-600 w-full text-sm">
                    
                    <button @click="generatePrompt" class="w-full bg-indigo-600 hover:bg-indigo-500 py-2 rounded font-bold text-sm transition">
                        <i class="fas fa-magic"></i> توليد البرومبت القائد
                    </button>

                    <!-- Prompt Display -->
                    <div v-if="generatedPrompt" class="mt-4">
                        <label class="text-xs text-gray-500 block mb-1">انسخ هذا وأرسله لـ Gemini/ChatGPT:</label>
                        <textarea readonly class="w-full h-32 bg-black/50 p-2 text-xs text-green-400 font-mono rounded border border-gray-700">{{ generatedPrompt }}</textarea>
                        <button @click="copyPrompt" class="mt-2 w-full bg-gray-700 hover:bg-gray-600 text-xs py-1 rounded">نسخ البرومبت</button>
                    </div>
                </div>

                <!-- STEP 2: Paste & Publish -->
                <div class="space-y-4 border-l border-gray-700 pl-8">
                    <h3 class="text-sm font-bold text-green-400 uppercase">2. النشر النهائي</h3>
                    
                    <div>
                        <label class="text-xs text-gray-400">عنوان المقال (Title)</label>
                        <input v-model="articleTitle" class="w-full bg-gray-900 p-2 rounded border border-gray-600 mb-2 text-sm">
                        
                        <label class="text-xs text-gray-400">الرابط (Slug) - يُنشأ تلقائياً</label>
                        <input v-model="articleSlug" class="w-full bg-gray-900 p-2 rounded border border-gray-600 text-xs text-gray-500 font-mono">
                    </div>

                    <div>
                        <label class="text-xs text-gray-400">لصق محتوى Gemini هنا (HTML):</label>
                        <textarea v-model="pastedContent" rows="8" class="w-full bg-gray-900 p-3 rounded border border-gray-600 text-sm text-gray-300" placeholder="<p>Paste the HTML output here...</p>"></textarea>
                    </div>

                    <button @click="publishArticle" class="w-full bg-green-600 hover:bg-green-500 py-3 rounded font-bold text-sm shadow-lg transition">
                        <i class="fas fa-check-circle"></i> نشر المقال فوراً
                    </button>

                    <p v-if="statusMsg" :class="statusColor" class="text-center text-sm font-bold mt-2">{{ statusMsg }}</p>
                </div>

            </div>
        </div>

    </div>
    {% endraw %}

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    password: '',
                    target: { device: '', country: '', app_name: '' },
                    generatedPrompt: '',
                    pastedContent: '',
                    articleTitle: '',
                    statusMsg: '',
                    statusColor: 'text-white'
                }
            },
            computed: {
                articleSlug() {
                    if (!this.target.device || !this.target.country) return '';
                    return `setup-iptv-on-${this.target.device}-in-${this.target.country}`
                        .toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
                }
            },
            watch: {
                // Auto-generate title when inputs change
                target: {
                    handler(val) {
                        if(val.device && val.country) {
                            this.articleTitle = `How to Setup IPTV on ${val.device} in ${val.country} (2026 Guide)`;
                        }
                    },
                    deep: true
                }
            },
            methods: {
                async generatePrompt() {
                    if(!this.target.device) return alert("Please fill device details");
                    
                    const res = await fetch('/api/generate-master-prompt', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(this.target)
                    });
                    const data = await res.json();
                    this.generatedPrompt = data.prompt;
                },
                copyPrompt() {
                    navigator.clipboard.writeText(this.generatedPrompt);
                    alert("تم النسخ! اذهب لـ Gemini الآن.");
                },
                async publishArticle() {
                    if(!this.password) return alert("Enter Secret Key");
                    if(!this.pastedContent) return alert("Paste content first");

                    this.statusMsg = "جاري النشر...";
                    
                    try {
                        const res = await fetch('/api/publish-manual', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                password: this.password,
                                project_slug: 'iptv-guides', // افتراضي
                                slug: this.articleSlug,
                                title: this.articleTitle,
                                html_content: this.pastedContent,
                                variables: this.target
                            })
                        });
                        const data = await res.json();
                        
                        if(data.status === 'success') {
                            this.statusMsg = `✅ تم النشر! الرابط: ${data.url}`;
                            this.statusColor = 'text-green-400';
                            // Clear form
                            this.pastedContent = '';
                        } else {
                            this.statusMsg = `❌ خطأ: ${data.message}`;
                            this.statusColor = 'text-red-400';
                        }
                    } catch(e) {
                        this.statusMsg = "خطأ في الاتصال";
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
