<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฃุฏุงุฉ ุงููููุงุช ุงูููุชุงุญูุฉ ุงูุงุญุชุฑุงููุฉ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>๐ ุฃุฏุงุฉ ุจุญุซ ุงููููุงุช ุงูููุชุงุญูุฉ</h1>
        <p>ุฃุฏุงุฉ ูุฌุงููุฉ ูุชุญููู ุงููููุงุช ุงูููุชุงุญูุฉ ูู ุฌูุฌู</p>
        
        <div class="search-box">
            <textarea id="keywords" placeholder="ุฃุฏุฎู ุงููููุงุช ุงูููุชุงุญูุฉ (ูู ูููุฉ ูู ุณุทุฑ)..."></textarea>
            <button onclick="searchKeywords()" id="searchBtn">ุงุจุฏุฃ ุงูุจุญุซ ๐</button>
        </div>
        
        <div id="loading" class="hidden">ุฌุงุฑู ุงูุจุญุซ... ูุฑุฌู ุงูุงูุชุธุงุฑ โณ</div>
        
        <div id="results" class="results-container"></div>
        
        <div class="actions">
            <button onclick="exportCSV()" class="btn-secondary">ุชุตุฏูุฑ CSV ๐ฅ</button>
        </div>
    </div>

    <script>
        let currentResults = [];
        
        async function searchKeywords() {
            const keywords = document.getElementById('keywords').value.split('\n').filter(k => k.trim());
            if (keywords.length === 0) return alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ูููุงุช ููุชุงุญูุฉ');
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('searchBtn').disabled = true;
            
            try {
                const response = await fetch('/api/research', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({keywords})
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    currentResults = data.data;
                    displayResults(data.data);
                }
            } catch (error) {
                alert('ุญุฏุซ ุฎุทุฃ: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('searchBtn').disabled = false;
            }
        }
        
        function displayResults(results) {
            const container = document.getElementById('results');
            container.innerHTML = results.map(r => `
                <div class="result-card">
                    <h3>๐ ${r.seed_keyword}</h3>
                    <p><strong>ุงููุชุงุฆุฌ:</strong> ${r.suggestions.length} ูููุฉ | <strong>ุงูุชุฑูุฏ:</strong> ${r.trends_score}</p>
                    <details>
                        <summary>ุนุฑุถ ุงููููุงุช ุงูููุชุฑุญุฉ (${r.suggestions.length})</summary>
                        <ul>${r.suggestions.map(s => `<li>${s}</li>`).join('')}</ul>
                    </details>
                </div>
            `).join('');
        }
        
        function exportCSV() {
            if (currentResults.length === 0) return alert('ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุชุตุฏูุฑูุง');
            
            let csv = 'ุงููููุฉ ุงูุฃุณุงุณูุฉ,ุงููููุงุช ุงูููุชุฑุญุฉ,ุฏุฑุฌุฉ ุงูุชุฑูุฏ\n';
            currentResults.forEach(r => {
                csv += `"${r.seed_keyword}","${r.suggestions.join(' | ')}",${r.trends_score}\n`;
            });
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `keywords_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
        }
    </script>
</body>
</html>
